/*! www.usitrip.com 2015-08-12 08:08:48 */
Usitrip.ns("usitrip.plugin"),usitrip.plugin.DragPlugin=function(a){Usitrip.apply(this,a),usitrip.plugin.DragPlugin.superclass.constructor.apply(this,arguments),this.init(a),this.addEvents("startdrag","movedrag","enddrag")},Usitrip.extend(usitrip.plugin.DragPlugin,usitrip.event.UsitripEvent,{sourceSelector:null,targetSelector:null,dragTimer:null,init:function(a){var b=this;this.ghostEl=null,this.sourceSelector.on("mousedown",$.proxy(this.doMouseDown,b))},doMouseDown:function(a){this.fireEvent("startdrag",this,a)},doMouseMove:function(a){this.fireEvent("movedrag",this,a)},doMouseUp:function(a){this.fireEvent("enddrag",this,a)}}),Usitrip.ns("usitrip.plugin"),usitrip.plugin.HorizontalDragPlugin=function(a){Usitrip.apply(this,a),usitrip.plugin.HorizontalDragPlugin.superclass.constructor.apply(this,arguments)},Usitrip.extend(usitrip.plugin.HorizontalDragPlugin,usitrip.plugin.DragPlugin,{doMouseDown:function(a){var b=this,c=$(document);this.dragTimer=setTimeout($.proxy(function(){for(var d=$(a.currentTarget||a.srcElement),e=this.sourceSelector.children(),f=0,g=e.length;g>f;f++)if(e[f]==d[0])return;this.dragEl=d;var h=(d.outerWidth(!0),d.outerHeight(!0),d.offset().top),i=d.offset().left,j=$(window).scrollLeft(),k=$(window).scrollTop(),l=a.clientX,m=a.clientY;this.disX=l-i,this.disY=m-h;var n='<div id="ghostWrap"><div id="ghosetStatus" class="dragghost"></div></div>';$("body").append(n),this.ghostEl=$("#ghostWrap");var o=d.clone();this.ghostEl.append(o),this.ghostStaus=this.ghostEl.find("#ghosetStatus");var p=this.getElAllStyle(a.srcElement||a.currentTarget);o.css(p),o.css({"float":"left",margin:0}),this.ghostEl.css({position:"absolute",top:a.clientY+k+20,left:a.clientX+j+10}),c.on("mousemove",$.proxy(this.doMouseMove,b)),usitrip.plugin.HorizontalDragPlugin.superclass.doMouseDown.apply(this,arguments)},b),200),c.on("mouseup",$.proxy(this.doMouseUp,b)),$("body").on("selectstart",$.proxy(this.doDragUnSelect,b)),Usitrip.isGecko&&$("body").css("-moz-user-select","none")},doMouseMove:function(a){var b=$(window).scrollLeft(),c=$(window).scrollTop();this.ghostEl&&this.ghostEl.css({top:a.clientY+c+20,left:a.clientX+b+10});var d=$(a.target);this.isBelongtoWrap(d)?this.ghostStaus.removeClass("error").addClass("right"):this.ghostStaus.removeClass("right").addClass("error"),usitrip.plugin.HorizontalDragPlugin.superclass.doMouseMove.apply(this,arguments)},doMouseUp:function(a){if(clearTimeout(this.dragTimer),this.dragTimer=null,this.dragEl){var b=this,c=$(a.target),d=this.dragEl.siblings();if(this.isBelongtoWrap(c)){for(var e=1e4,f="",g=1e4,f="",h={},i=0,j=d.length;j>i;i++){var k=$(d[i]),l=Math.abs(k.offset().left-a.clientX-scrollX),m=Math.abs(k.offset().left-a.clientX-scrollX+k.outerWidth()),n=Math.abs(k.offset().top-a.clientY-scrollY),o=Math.abs(k.offset().top-a.clientY-scrollY+k.outerHeight());l>m&&e>=m?(e=m,f="after",n>o&&g>=o?(g=o,h=k):g>=n&&(g=n,h=k)):e>=l&&(e=l,f="before",n>o&&g>=o?(g=o,h=k):g>=n&&(g=n,h=k))}"before"==f?h.before(this.dragEl):h.after(this.dragEl),this.ghostEl.remove()}else this.ghostEl.animate({left:this.dragEl.offset().left,top:this.dragEl.offset().top,opacity:0},800,function(){b.ghostEl.remove()});usitrip.plugin.HorizontalDragPlugin.superclass.doMouseUp.apply(this,arguments),this.destroy(a)}},destroy:function(a){console.log("doMouseUp"),$("body").unbind("selectstart",$.proxy(this.doDragUnSelect,self));var b=$(document);b.unbind("mousemove",$.proxy(this.doMouseMove,self)),b.unbind("mouseup",$.proxy(this.doMouseUp,self))},getElAllStyle:function(a){var b=a.currentStyle?a.currentStyle:window.getComputedStyle(a,null),c={};for(var d in b){var e=b[d];Usitrip.isIE&&Usitrip.isString(e)?c[d]=e:isNaN(Number(d))||(c[e]=$(a).css(e))}return c},doDragUnSelect:function(){return!1},isBelongtoWrap:function(a){for(var b=0,c=this.targetSelector.length;c>b;b++){var d=this.targetSelector[b];if(d==a[0]&&d!=this.dragEl[0])return!0}var e=this.targetSelector.has(a);return e.length>0&&a[0]!=this.dragEl[0]?!0:!1}}),Usitrip.ns("usitrip.plugin"),usitrip.plugin.MultiplePlugin=function(a){Usitrip.apply(this,a),usitrip.plugin.MultiplePlugin.superclass.constructor.apply(this,arguments),this.init(a)},Usitrip.extend(usitrip.plugin.MultiplePlugin,usitrip.event.UsitripEvent,{btnEl:null,selector:null,multiplied:null,multiplicand:null,init:function(a){var b=this;this.btnEl.live("click",function(){var a=$(b.selector);a.each(function(a,c){b.setValue($(this),b.multiplicand.val())})})},setValue:function(a,b){var c=a.attr(this.multiplied);isNaN(c)||isNaN(b)||a.val(parseFloat((parseFloat(c)*b).toFixed(3)).toFixed(2))}}),Usitrip.ns("usitrip.plugin"),usitrip.plugin.QuickDeletePlugin=function(a){usitrip.plugin.QuickDeletePlugin.superclass.constructor.apply(this,arguments),this.init(a)},Usitrip.extend(usitrip.plugin.QuickDeletePlugin,usitrip.event.UsitripEvent,{selector:"input[type=text]",_click:null,init:function(a){Usitrip.apply(this,a);var b=$(this.selector);null==this._click&&(this._click=function(){var a=$(this).prev();a.val(""),$(this).hide(),a.focus()}),this.render(b)},render:function(a){var b='<div class="quick-delete"></div>',c=this;a.each(function(){var a=$(this);if(a.attr("readonly")||a.attr("disabled"));else{var d=a.parent(),e=d.css("position");"absolute"==e||"fixed"==e?d.wrapInner(function(){return'<div class="quickPosi" />'}):d.css("position","relative"),a.after(b);var f=a.next();c.ininEvent(f,a)}})},initPosition:function(a,b){var c=b.css("marginTop"),d=b.css("paddingTop"),e=b.css("borderTop"),f=b.position().top;c=c?parseFloat(c):0,d=d?parseFloat(d):0,e=e?parseFloat(e):0,f=f?parseFloat(f):0;var g=b.height()/a.height()*100;g>=100&&(g=100),a.css({top:c+d+e+f,backgroundSize:g+"%"});var h=b.css("marginLeft"),i=b.css("paddingLeft"),j=b.css("borderLeft"),k=b.position().left;h=h?parseFloat(h):0,i=i?parseFloat(i):0,j=j?parseFloat(j):0,k=k?parseFloat(k):0,a.css({left:b.width()-a.width()*parseFloat(a.css("backgroundSize"))/100+h+i+j+k})},ininEvent:function(a,b){var c=this,d=b.get(0).tagName;"INPUT"==d||"TEXTAREA"==d?(b.focusin(function(){$(this).val()?(c.initPosition(a,b),a.show()):a.hide()}),b.focusout(function(){setTimeout(function(){a.hide()},300)}),b.keyup(function(){$(this).val()?(c.initPosition(a,b),a.show()):a.hide()})):b.parent().hover(function(){c.initPosition(a,b),a.toggle()}),a.click(c._click)}}),Usitrip.ns("usitrip.plugin"),usitrip.plugin.ReferencePlugin=function(a){Usitrip.apply(this,a),usitrip.plugin.ReferencePlugin.superclass.constructor.apply(this,arguments),this.init(a)},Usitrip.extend(usitrip.plugin.ReferencePlugin,usitrip.event.UsitripEvent,{btnEl:null,sourceSelector:null,targetSelector:null,callback:null,mapping:null,init:function(a){var b=this;this.btnEl.live("click",function(){var a=null;a=b.sourceSelector.constructor==Function?b.sourceSelector(this):$(b.sourceSelector);var c=null;c=b.targetSelector.constructor==Function?b.targetSelector(this):$(b.targetSelector);var d=b.mapping;if(d){var e=d.id,f=d.name,g=d["class"];for(var h in g){var i=g[h],j='input[class^="'+h+'"],select[class^="'+h+'"]';if(i.indexOf(",")>-1)for(var k=i.split(","),l=0,m=k.length;m>l;l++){var n=k[l].replace(/(^\s*)|(\s*$)/g,""),o='input[class^="'+n+'"],select[class^="'+n+'"]';b.setValue(a.filter(j),c.filter(o))}else{var o='input[class^="'+i+'"],select[class^="'+i+'"]';b.setValue(a.filter(j),c.filter(o))}}for(var h in f){var i=f[h],j='input[name^="'+h+'"],select[name^="'+h+'"]';if(i.indexOf(",")>-1)for(var k=i.split(","),l=0,m=k.length;m>l;l++){var n=k[l].replace(/(^\s*)|(\s*$)/g,""),o='input[name^="'+n+'"],select[name^="'+n+'"]';b.setValue(a.filter(j),c.filter(o))}else{var o='input[name^="'+i+'"],select[name^="'+i+'"]';b.setValue(a.filter(j),c.filter(o))}}for(var h in e){var i=e[h],j='input[id^="'+h+'"],select[id^="'+h+'"]';if(i.indexOf(",")>-1)for(var k=i.split(","),l=0,m=k.length;m>l;l++){var n=k[l].replace(/(^\s*)|(\s*$)/g,""),o='input[id^="'+n+'"],select[id^="'+n+'"]';b.setValue(a.filter(j),c.filter(o))}else{var o='input[id^="'+i+'"],select[id^="'+i+'"]';b.setValue(a.filter(j),c.filter(o))}}}else a.each(function(a,d){b.setValue($(this),c.eq(a))});null!=b.callback&&b.callback(this)})},setValue:function(a,b){if(a.is("select"))b.val(a.val());else{var c=a.attr("type");"checkbox"===c?b.attr("checked",!!a.attr("checked")):"radio"===c?b.attr("checked",a.attr("checked")):"select"===c?b.attr("checked",a.attr("checked")):b.val(a.val())}}}),Usitrip.ns("usitrip.plugin"),usitrip.plugin.VerticalDragPlugin=function(a){Usitrip.apply(this,a),usitrip.plugin.VerticalDragPlugin.superclass.constructor.apply(this,arguments)},Usitrip.extend(usitrip.plugin.VerticalDragPlugin,usitrip.plugin.DragPlugin,{doMouseDown:function(a){var b=this,c=$(document);this.dragTimer=setTimeout($.proxy(function(){for(var d=$(a.currentTarget||a.srcElement),e=this.sourceSelector.children(),f=0,g=e.length;g>f;f++)if(e[f]==d[0])return;this.dragEl=d;var h=d.offset().top,i=d.offset().left,j=$(window).scrollLeft(),k=$(window).scrollTop(),l=a.clientX,m=a.clientY;this.disX=l-i,this.disY=m-h;var n='<div id="ghostWrap"><div id="ghosetStatus" class="dragghost"></div></div>';$("body").append(n),this.ghostEl=$("#ghostWrap");var o=d.clone();this.ghostEl.append(o),this.ghostStaus=this.ghostEl.find("#ghosetStatus");var p=this.getElAllStyle(a.currentTarget||a.srcElement);o.css(p),o.css({"float":"left",margin:0}),this.ghostEl.css({position:"absolute",top:a.clientY+k+20,left:a.clientX+j+10});var q=$(a.target);this.isBelongtoWrap(q)?this.ghostStaus.removeClass("error").addClass("right"):this.ghostStaus.removeClass("right").addClass("error"),c.on("mousemove",$.proxy(this.doMouseMove,b)),usitrip.plugin.VerticalDragPlugin.superclass.doMouseDown.apply(this,arguments)},b),200),c.on("mouseup",$.proxy(this.doMouseUp,b)),$("body").on("selectstart",$.proxy(this.doDragUnSelect,b)),Usitrip.isGecko&&$("body").css("-moz-user-select","none")},doMouseMove:function(a){var b=$(window).scrollLeft(),c=$(window).scrollTop();this.ghostEl&&this.ghostEl.css({top:a.clientY+c+20,left:a.clientX+b+10});var d=$(a.target);this.isBelongtoWrap(d)?this.ghostStaus.removeClass("error").addClass("right"):this.ghostStaus.removeClass("right").addClass("error"),usitrip.plugin.VerticalDragPlugin.superclass.doMouseMove.apply(this,arguments)},doMouseUp:function(a){if(clearTimeout(this.dragTimer),this.dragTimer=null,this.dragEl){var b=this,c=$(a.target),d=this.dragEl.siblings();if(this.isBelongtoWrap(c)){for(var e=1e4,f={},g="",h=0,i=d.length;i>h;h++){var j=$(d[h]),k=Math.abs(j.offset().top-a.clientY-scrollY),l=Math.abs(j.offset().top-a.clientY-scrollY+j.outerHeight());k>l&&e>l?(e=l,g="after",f=j):e>k&&(e=k,f=j,g="before")}"before"==g?f.before(this.dragEl):f.after(this.dragEl),this.ghostEl.remove()}else this.ghostEl.animate({left:this.dragEl.offset().left,top:this.dragEl.offset().top,opacity:0},800,function(){b.ghostEl.remove()});usitrip.plugin.VerticalDragPlugin.superclass.doMouseUp.apply(this,arguments),this.destroy(a)}},destroy:function(a){$("body").unbind("selectstart",$.proxy(this.doDragUnSelect,self));var b=$(document);b.unbind("mousemove",$.proxy(this.doMouseMove,self)),b.unbind("mouseup",$.proxy(this.doMouseUp,self))},getElAllStyle:function(a){var b=a.currentStyle?a.currentStyle:window.getComputedStyle(a,null),c={};for(var d in b){var e=b[d];Usitrip.isIE&&Usitrip.isString(e)?c[d]=e:isNaN(Number(d))||(c[e]=$(a).css(e))}return c},doDragUnSelect:function(){return!1},isBelongtoWrap:function(a){for(var b=0,c=this.targetSelector.length;c>b;b++){var d=this.targetSelector[b];if(d==a[0]&&d!=this.dragEl[0])return!0}var e=this.targetSelector.has(a);return e.length>0&&a[0]!=this.dragEl[0]?!0:!1}});