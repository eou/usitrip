Usitrip.ns("usitrip.plugin"),usitrip.plugin.VerticalDragPlugin=function(config){Usitrip.apply(this,config),usitrip.plugin.VerticalDragPlugin.superclass.constructor.apply(this,arguments)},Usitrip.extend(usitrip.plugin.VerticalDragPlugin,usitrip.plugin.DragPlugin,{doMouseDown:function(e){var self=this,doc=$(document);this.dragTimer=setTimeout($.proxy(function(){for(var currentSouceEl=$(e.currentTarget||e.srcElement),innerEl=this.sourceSelector.children(),i=0,len=innerEl.length;len>i;i++)if(innerEl[i]==currentSouceEl[0])return;this.dragEl=currentSouceEl;var offsetY=currentSouceEl.offset().top,offsetX=currentSouceEl.offset().left,scrollX=$(window).scrollLeft(),scrollY=$(window).scrollTop(),mouseX=e.clientX,mouseY=e.clientY;this.disX=mouseX-offsetX,this.disY=mouseY-offsetY;var ghostWrap='<div id="ghostWrap"><div id="ghosetStatus" class="dragghost"></div></div>';$("body").append(ghostWrap),this.ghostEl=$("#ghostWrap");var cloneEl=currentSouceEl.clone();this.ghostEl.append(cloneEl),this.ghostStaus=this.ghostEl.find("#ghosetStatus");var allStyle=this.getElAllStyle(e.currentTarget||e.srcElement);cloneEl.css(allStyle),cloneEl.css({"float":"left",margin:0}),this.ghostEl.css({position:"absolute",top:e.clientY+scrollY+20,left:e.clientX+scrollX+10});var targetEl=$(e.target);this.isBelongtoWrap(targetEl)?this.ghostStaus.removeClass("error").addClass("right"):this.ghostStaus.removeClass("right").addClass("error"),doc.on("mousemove",$.proxy(this.doMouseMove,self)),usitrip.plugin.VerticalDragPlugin.superclass.doMouseDown.apply(this,arguments)},self),200),doc.on("mouseup",$.proxy(this.doMouseUp,self)),$("body").on("selectstart",$.proxy(this.doDragUnSelect,self)),Usitrip.isGecko&&$("body").css("-moz-user-select","none")},doMouseMove:function(e){var scrollX=$(window).scrollLeft(),scrollY=$(window).scrollTop();this.ghostEl&&this.ghostEl.css({top:e.clientY+scrollY+20,left:e.clientX+scrollX+10});var targetEl=$(e.target);this.isBelongtoWrap(targetEl)?this.ghostStaus.removeClass("error").addClass("right"):this.ghostStaus.removeClass("right").addClass("error"),usitrip.plugin.VerticalDragPlugin.superclass.doMouseMove.apply(this,arguments)},doMouseUp:function(e){if(clearTimeout(this.dragTimer),this.dragTimer=null,this.dragEl){var self=this,targetEl=$(e.target),brothersEl=this.dragEl.siblings();if(this.isBelongtoWrap(targetEl)){for(var minVerDis=1e4,minVerDisEl={},minVerDisElPositon="",i=0,len=brothersEl.length;len>i;i++){var el=$(brothersEl[i]),topDis=Math.abs(el.offset().top-e.clientY-scrollY),bottomDis=Math.abs(el.offset().top-e.clientY-scrollY+el.outerHeight());topDis>bottomDis&&minVerDis>bottomDis?(minVerDis=bottomDis,minVerDisElPositon="after",minVerDisEl=el):minVerDis>topDis&&(minVerDis=topDis,minVerDisEl=el,minVerDisElPositon="before")}"before"==minVerDisElPositon?minVerDisEl.before(this.dragEl):minVerDisEl.after(this.dragEl),this.ghostEl.remove()}else this.ghostEl.animate({left:this.dragEl.offset().left,top:this.dragEl.offset().top,opacity:0},800,function(){self.ghostEl.remove()});usitrip.plugin.VerticalDragPlugin.superclass.doMouseUp.apply(this,arguments),this.destroy(e)}},destroy:function(e){this.dragEl=null,$("body").unbind("selectstart",$.proxy(this.doDragUnSelect,self));var doc=$(document);doc.unbind("mousemove",$.proxy(this.doMouseMove,self)),doc.unbind("mouseup",$.proxy(this.doMouseUp,self))},getElAllStyle:function(el){var allStyle=el.currentStyle?el.currentStyle:window.getComputedStyle(el,null),result={};for(var p in allStyle){var value=allStyle[p];Usitrip.isIE&&Usitrip.isString(value)?result[p]=value:isNaN(Number(p))||(result[value]=$(el).css(value))}return result},doDragUnSelect:function(){return!1},isBelongtoWrap:function(currentTargetEl){for(var i=0,len=this.targetSelector.length;len>i;i++){var t=this.targetSelector[i];if(t==currentTargetEl[0]&&t!=this.dragEl[0])return!0}var el=this.targetSelector.has(currentTargetEl);return el.length>0&&currentTargetEl[0]!=this.dragEl[0]?!0:!1}});